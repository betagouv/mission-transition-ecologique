@use 'sass:map';
@use 'sass:list';
@use '@gouvfr/dsfr/.config/icon' as dsfr-icons;
@use '@gouvfr/dsfr/src/dsfr/core/style/icon/setting' as dsfr-icons-setting;
@use '@gouvfr/dsfr/src/dsfr/core/style/display/tool/mask-image';
@import "@gouvfr/dsfr/dist/component/navigation/navigation.css";
@import "@gouvfr/dsfr/dist/core/core.css";
@import "@gouvfr/dsfr/dist/core/core.legacy.css";
@import "@gouvfr/dsfr/dist/component/button/button.css";
@import "@gouvfr/dsfr/dist/component/accordion/accordion.css";
@import "@gouvfr/dsfr/dist/component/header/header.css";
@import "@gouvfr/dsfr/dist/component/logo/logo.css";
@import "@gouvfr/dsfr/dist/component/link/link.css";
@import "@gouvfr/dsfr/dist/component/form/form.css";
@import "@gouvfr/dsfr/dist/component/modal/modal.css";
@import "@gouvfr/dsfr/dist/component/input/input.css";
@import "@gouvfr/dsfr/dist/component/search/search.css";
@import '@gouvfr/dsfr/dist/component/footer/footer.css';
@import "@gouvfr/dsfr/dist/component/badge/badge.css";
@import "@gouvfr/dsfr/dist/component/card/card.css";
@import "@gouvfr/dsfr/dist/component/breadcrumb/breadcrumb.css";
@import "@gouvfr/dsfr/dist/component/highlight/highlight.css";
@import "@gouvfr/dsfr/dist/component/table/table.css";
@import "@gouvfr/dsfr/dist/component/tab/tab.css";
@import "@gouvfr/dsfr/dist/component/sidemenu/sidemenu.css";
@import "@gouvfr/dsfr/dist/component/tag/tag.css";
@import "@gouvfr/dsfr/dist/component/tile/tile.css";
@import "@gouvfr/dsfr/dist/component/select/select.css";



// Custom icon import approach
// This file implements a custom approach to import only the specific icons we need,
// rather than importing entire icon categories. This reduces the CSS bundle size.

// To add a new icon:
// 1. Add the icon configuration to the $custom-icons-config map below
// 2. Add the icon selector to the list of selectors in the .fr-icon block
// 3. Add a specific rule for the icon using the get-icon-url function


// Define a custom subset of icons

// Define our custom icons list
$icons-list: (
  // Maps icons
  map-pin-2-line,
  // System icons
  arrow-left-line,
  arrow-right-line,
  check-line,
  close-circle-fill,
  close-line,
  // Business icons
  mail-line,
  briefcase-line,
  // Editor icons
  link,
  // Finance icons
  money-euro-circle-line,
  // user icons
  team-line,
  account-pin-circle-line,
  account-circle-fill,
  // editor icons
  question-mark
);

// Create merged icon configuration map
$custom-icons-config: ();

@each $icon in $icons-list {
  $icon-config: map.get(dsfr-icons.$icons-config, $icon);

  @if $icon-config {
    $custom-icons-config: map.merge($custom-icons-config, ($icon: $icon-config));
  }
}

@function getIconPseudo($restrain) {
  @if $restrain == before or $restrain == after {
    @return $restrain;
  }

  @return before after;
}

@mixin pseudo($type:before, $content:null, $display:null) {
  @if $type != after and $type != before and $type != marker and $type != (before after) {
    @error '$type must be before or after element';
  }

  $selector: ();

  @each $pseudo in $type {
    $selector: list.append($selector, '&::#{$pseudo}', 'comma');
  }

  #{$selector} {
    @if $content {
      content: $content;
    }

    @if $display {
      display: #{$display};
    }

    @content;
  }
}

// Helper functions and mixins for icon generation
@function getIconUrl($icon, $important: false) {
  $config: map.get($custom-icons-config, $icon);
  $url: url('../../../../node_modules/@gouvfr/dsfr/dist/#{map.get($config, path)}');

  @return $url if($important, !important, null);
}

@mixin icon-pseudo($restrain: null) {
  @include pseudo(getIconPseudo($restrain)) {
    @content;
  }
}

@mixin icon-image($icon, $restrain: null, $important: false) {
  $url: getIconUrl($icon, $important);

  @include icon-pseudo($restrain) {
    @include mask-image.mask-image($url);
  }
}

// Generate icon classes
.fr-icon {
  @each $icon, $setting in $custom-icons-config {
    &#{-#{$icon}} {
      @include icon-image($icon);
    }
  }
}

// List of icons used in the project:
// 1. `fr-icon-close-circle-fill` (system)
// 2. `fr-icon-arrow-right-line` (system)
// 3. `fr-icon-mail-line` (business)
// 4. `fr-icon-close-line` (system)
// 5. `fr-icon-link` (editor)
// 6. `fr-icon-check-line` (system)
// 7. `fr-icon-arrow-left-line` (system)
