{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Dispositif",
  "description": "Données de dispositifs, avec des informations générales, relatifs à l'aide proposée et des données d'éligibilité.",
  "type": "object",
  "properties": {
    "titre": {
      "description": "Titre du dispositif. Le titre est optionnel, s'il est absent, un titre générique du type \"Dispositif { opérateur de contact }\" sera utilisé.",
      "type": "string"
    },
    "promesse": {
      "description": "TODO",
      "type": "string"
    },
    "url": {
      "description": "TODO",
      "type": "string"
    },
    "illustration": {
      "description": "TODO",
      "type": "string"
    },
    "objectifs": {
      "description": "TODO",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "conditions": {
      "description": "TODO",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": {
            "description": "TODO",
            "type": "string"
          },
          "operator": {
            "description": "TODO",
            "type": "string"
          },
          "value": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "opérateur de contact": {
      "description": "L'opérateur de contact est l'opérateur à contacter pour obtenir des informations supplémentaires sur le dispositif.",
      "type": "string",
      "$ref": "#/$defs/operators"
    },
    "autres opérateurs": {
      "description": "Les autres opérateurs peuvent être des opérateurs co-financeurs, ou des partenaires du dispositif. Ils doivent être différents de l'opérateur de contcat.",
      "type": "array",
      "items": {
        "type": "string",
        "$ref": "#/$defs/operators"
      },
      "uniqueItems": true
    },
    "nature de l'aide": {
      "description": "Précise s'il s'agit d'une aide financière, d'un accompagnement, ou d'un prêt. Un accompagnement se définit comme la réalisation d'une prestation intellectuelle, par un intervenant choisi par l'opérateur.",
      "enum": [
        "accompagnement",
        "financement",
        "prêt"
      ]
    },
    "publicodes": {
      "description": "Mécanismes publicodes (https://publi.codes/) associés au dispositif. Doit être en langage publicodes valide. Les données nécessaires à l'évaluation des règles (contrat d'interface) sont matérialisés par des clés sans valeurs.",
      "type": "object",
      "properties": {
        "éligibilité": {
          "description": "Mécanisme pour évaluer si une entreprise est éligible ou non au dispositif"
        }
      },
      "required": ["éligibilité"]
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "nature de l'aide": { "const": "accompagnement" } }
      },
      "then": {
        "properties": {
          "coût de l'accompagnement": {
            "description": "Ce champ est utile et requis uniquement si l'aide est de nature \"accompagnement\". Elle précise le coût reste à charge de l'utilisateur pour bénéficier de l'accompagnement. Il s'agit d'un champ texte, à des fins d'affichage.",
            "type": "string"
          }
        },
        "required": [ "coût de l'accompagnement" ]
      }
    },
    {
      "if": {
        "properties": { "nature de l'aide": { "const": "financement" }}
      },
      "then": {
        "properties": {
          "montant du financement": {
            "description": "Ce champ est utile et requis uniquement si l'aide est de nature \"financement\". Elle précise le montant du financement, de préférence en €, à défaut en %. Il s'agit d'un champ texte, à des fins d'affichage.",
            "type": "string"
          }
        },
        "required": [ "montant du financement" ]
      }
    },
    {
      "if": {
        "properties": { "nature de l'aide": { "const": "prêt" }}
      },
      "then": {
        "properties": {
          "taux du prêt": {
            "description": "Ce champ est utile et requis uniquement si l'aide est de nature \"prêt\". Il s'agit d'un champ texte, à des fins d'affichage.",
            "type": "string"
          }
        },
        "required": [ "taux du prêt" ]
      }
    }
  ],
  "required": [
    "titre",
    "promesse",
    "illustration",
    "objectifs",
    "opérateur de contact",
    "nature de l'aide",
    "publicodes"
  ],

  "$defs": {
    "operators": {
      "enum": [
        "ADEME",
        "ASP",
        "Agence de l'eau Adour-Garonne",
        "Agence de l'eau Artois-Picardie",
        "Agence de l'eau Loire-Bretagne",
        "Agence de l'eau Rhin-Meuse",
        "Agence de l'eau Rhône-Méditerranée-Corse",
        "Agence de l'eau Seine-Normandie",
        "Bpifrance",
        "Breizh Fab",
        "CCI Auvergne-Rhône-Alpes",
        "CCI Bretagne",
        "CCI Centre-Val de Loire",
        "CCI Grand-Est",
        "CCI Hauts-de-France",
        "CCI Loir-et-Cher",
        "CCI Loiret",
        "CCI Morbihan",
        "CCI Normandie",
        "CCI Occitanie",
        "CCI Île-de-France",
        "CCI",
        "CMA Auvergne-Rhône-Alpes",
        "CMA Bourgogne-Franche-Comté",
        "CMA Bretagne",
        "CMA Centre-Val de Loire",
        "CMA Grand-Est",
        "CMA Hauts-de-France",
        "CMA La Réunion",
        "CMA Loiret",
        "CMA Normandie",
        "CMA Nouvelle-Aquitaine",
        "CMA Provence-Alpes-Côte-D'Azur",
        "CMA Rhône",
        "CMA Île-de-France",
        "CMA",
        "DDFIP",
        "EcoCO2",
        "La Poste",
        "Ministère de la Transition Écologique et Solidaire",
        "ORACE"
      ]
    }
  }
}
